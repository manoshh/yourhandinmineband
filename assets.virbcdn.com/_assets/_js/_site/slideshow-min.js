(function(e){var t=e(document);e.slideshow={inTransition:false,currentCount:0,nextCount:0,currentHash:false,hashInterval:false,debug:false,init:function(t){this.totalCount=t.totalCount;this.attachEvents();this.parseHash();this.hashInterval=setInterval(function(){e.slideshow.hashListener()},200)},hashListener:function(){var t=this.getHash();var n=t.split("index.html");if(t!=this.currentHash&&(n[1]&&n[1]=="i"||!n[0])){if(this.debug)console.log(n);if(t==""){this.nextCount=0;this.selectSlide({animate:true,noHash:true})}else{this.parseHash({animate:true})}}else if(t!=this.currentHash&&n[1]&&n[1]=="t"){if(this.debug)console.log(n);e("#media ul.thumbs").show();e("#media .slideshow").hide();e("#media .slideshow_nav").hide();this.currentHash="#/t/"+this.currentCount}},getHash:function(){var e=window.location.hash;try{e=window.parent.virb.$.customize.customizeHash}catch(t){}return e},setHash:function(e){try{window.parent.virb.$.customize.customizeHash="#"+e}catch(t){window.location.hash=e}},parseHash:function(e){var t=this.getHash();var n=t.split("index.html");if(n[1]&&n[1]=="i"&&n[2]&&n[2]*1>=0){this.nextCount=n[2]*1;this.selectSlide(e)}},attachEvents:function(){e("#prevItem").click(function(t){if(!e.slideshow.inTransition){e.slideshow.prevSlide()}return false});t.bind("keyup",function(t){e.slideshow.handleKeyPress(t)});e("#nextItem").click(function(){if(!e.slideshow.inTransition){e.slideshow.nextSlide()}return false});e("#media ul.thumbs a").click(function(){if(!e.slideshow.inTransition){params=e.parseJSON(e(this).attr("params"));e.slideshow.nextCount=params.index;e.slideshow.selectSlide()}return false});e("#backToThumbnails").click(function(){e("#media ul.thumbs").show();e("#media .slideshow").hide();e("#media .slideshow_nav").hide();e.slideshow.setHash("/t/"+e.slideshow.currentCount);this.currentHash="#/t/"+e.slideshow.currentCount;return false})},handleKeyPress:function(t){if(!this.inTransition&&e("#media .slideshow").is(":visible")){if(t.keyCode==39){this.nextSlide()}else if(t.keyCode==37){this.prevSlide()}else if(t.keyCode==27){if(e("#media ul.thumbs").length>0){e("#media ul.thumbs").show();e("#media .slideshow").hide();e("#media .slideshow_nav").hide();this.setHash("/t/"+this.currentCount);this.currentHash="#/t/"+this.currentCount}}}return false},nextSlide:function(){this.nextCount=this.currentCount*1+1;if(this.nextCount>this.totalCount-1){this.nextCount=0}this.selectSlide({animate:true})},prevSlide:function(){this.nextCount=this.currentCount*1-1;if(this.nextCount<0){this.nextCount=this.totalCount-1}this.selectSlide({animate:true})},selectSlide:function(t){if(this.debug)console.log("selectSlide");if(e.site)e.site.pauseVideos();if(this.nextCount!=this.currentCount){e("#media ul.thumbs").hide();e("#media .slideshow").show();e("#media .slideshow_nav").show();if(e.site){e.site.loadImageByIndex(this.nextCount,true)}e("#media .current_count").html(this.nextCount*1+1);if(t&&t.animate){$next=e("#media ul.slideshow>li:eq("+this.nextCount+")");$current=e("#media ul.slideshow>li:eq("+this.currentCount+")");$nextImg=$next.find("img:first");$currentImg=$current.find("img:first");var n=$nextImg.width();var r=$nextImg.position();var i=$currentImg.width();if($nextImg.css("width")=="100%"){$currentImg.css({width:$nextImg.width()})}this.inTransition=true;$next.fadeIn("slow",function(){$this=e(this);e.slideshow.inTransition=false;$currentImg.css({width:i})});$current.hide()}else{e("#media ul.slideshow>li:eq("+this.nextCount+")").css("position","relative").show();e("#media ul.slideshow>li:eq("+this.currentCount+")").hide()}this.currentCount=this.nextCount;if(t&&t.noHash){this.currentHash=""}else if(e("body").hasClass("fullscreen")==false){this.setHash("/i/"+this.currentCount);this.currentHash="#/i/"+this.currentCount}}else{e.site.loadImageByIndex(this.nextCount,true);e("#media ul.thumbs").hide();e("#media .slideshow").show();e("#media .slideshow_nav").show();if(e("body").hasClass("fullscreen")==false)this.setHash("/i/"+this.currentCount);this.currentHash="#/i/"+this.currentCount}}};virb.$.slideshow=e.slideshow})(virb.$)
